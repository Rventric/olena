#! /bin/sh

# Check that each header is self contained and generates no warning.

: ${VERBOSE=1}

. ../check/defs || exit 1

set -e

rm -f failures

if test $# = 0; then
  find "$PATH_TO_OLN_SRCDIR/oln" -name "${1-*}.hh" \
    -a ! -path '*/obsolete/*' -type f \
    -a ! -path '*/internal/*' -type f -print |
    sed "s,$PATH_TO_OLN_SRCDIR/,,g"
else
  echo "$@"
fi |
while read file; do
   echo "#include <$file>" > incltest.cc
   if $CXX $CPPFLAGS $CXXFLAGS -c incltest.cc; then
      echo "  PASS: $file"
   else
      echo "  FAIL: $file"
      echo "  $file" >> failures
   fi
done

if test -f failures; then
   echo "Failed files:"
   cat failures
   rm failures
   exit 1;
fi
