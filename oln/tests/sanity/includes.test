#! /bin/sh

# Check that each header is self contained and generates no warning.

: ${VERBOSE=1}

. ../defs || exit 1

if test "$GXX" = yes; then
  CXXFLAGS="$CXXFLAGS -Werror"
fi

set -e

rm -f failures

find "$OLN_INCLUDE_DIR/oln" -name "${1-*}.hh" \
                    -a ! -path '*/old/*' \
                    -a ! -path '*/obsolete/*' -type f -print |
while read file; do
   name=`expr $file : "$OLN_INCLUDE_DIR/\(.*\)"`
   echo "#include <$name>" > incltest.cc
   if $CXX $CPPFLAGS $CXXFLAGS -c incltest.cc; then
      echo "  PASS: $name"
   else
      echo "  FAIL: $name"
      echo "  $name" >> failures
   fi
done

if test -f failures; then
   echo "Failed files:"
   cat failures
   rm failures
   exit 1;
fi
